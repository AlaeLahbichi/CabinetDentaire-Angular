
<div class="container">
    <app-sidebar [animation]="LinkActive"></app-sidebar>
    <div class="main-content">
        <div class="content-header">
            <h1>Gestion des Avis Clients</h1>
            <p>Consultez et gérez tous les avis laissés par vos clients</p>
        </div>

        <div class="reviews-section">
            <div class="reviews-list">
                <h2 class="section-title">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    Avis Récents
                </h2>
                <div id="reviewsList">
                    <div class="review-item" *ngFor="let x of avis">
                        <div class="review-header">
                            <span class="reviewer-name">{{x.user.lastName}} {{x.user.firstName}}</span>
                            <span class="review-date">{{getTimeAgo(x.dateCreation)}}</span>
                        </div>
                        <div class="stars" *ngIf="x.note == '5'">
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                        </div>
                        <div class="stars" *ngIf="x.note == '4'">
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">☆</span>
                        </div>
                        <div class="stars" *ngIf="x.note == '3'">
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                        </div>
                        <div class="stars" *ngIf="x.note == '2'">
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                        </div>
                        <div class="stars" *ngIf="x.note == '1'">
                            <span class="star">★</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                            <span class="star">☆</span>
                        </div>
                        <p class="review-text">{{x.texte}}</p>
                    </div>
                </div>
            </div>

            <div class="add-review">
                <h2 class="section-title">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    Ajouter un Avis
                </h2>

                <form id="reviewForm" [formGroup]="avisForm" (ngSubmit)="envoyerAvis()">
                    <div class="form-group">
                        <label class="form-label" for="reviewerName">E-mail</label>
                        <input type="email" id="reviewerName" formControlName="email" class="form-input" placeholder="Votre Email" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="ratingSelect">Note</label>
                        <select id="ratingSelect" formControlName="note" class="form-input" required>
                            <option value="0">Choisir une note</option>
                            <option value="1">★☆☆☆☆ (1 étoile)</option>
                            <option value="2">★★☆☆☆ (2 étoiles)</option>
                            <option value="3">★★★☆☆ (3 étoiles)</option>
                            <option value="4">★★★★☆ (4 étoiles)</option>
                            <option value="5">★★★★★ (5 étoiles)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="reviewText">Votre avis</label>
                        <textarea id="reviewText"  formControlName="texte" class="form-input form-textarea" placeholder="Partagez votre expérience..." required></textarea>
                    </div>

                    <button type="submit" class="submit-btn">Publier l'avis</button>
                </form>
            </div>
        </div>
    </div>
</div>
    <script>


        // Filter reviews by rating
        const starFilters = document.querySelectorAll('.star-filter');
        const reviewItems = document.querySelectorAll('.review-item');
        
        starFilters.forEach(filter => {
            filter.addEventListener('click', function() {
                starFilters.forEach(f => f.classList.remove('active'));
                this.classList.add('active');
                
                const rating = this.dataset.rating;
                
                reviewItems.forEach(item => {
                    if (rating === 'all' || item.dataset.rating === rating) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });

        // Form submission
        document.getElementById('reviewForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedRating = parseInt(document.getElementById('ratingSelect').value);
            
            if (!selectedRating) {
                alert('Veuillez sélectionner une note');
                return;
            }
            
            const name = document.getElementById('reviewerName').value;
            const text = document.getElementById('reviewText').value;
            
            // Create new review element
            const newReview = document.createElement('div');
            newReview.className = 'review-item';
            newReview.dataset.rating = selectedRating;
            
            const starsHtml = Array.from({length: 5}, (_, i) => 
                `<span class="star">${i < selectedRating ? '★' : '☆'}</span>`
            ).join('');
            
            newReview.innerHTML = `
                <div class="review-header">
                    <span class="reviewer-name">${name}</span>
                    <span class="review-date">À l'instant</span>
                </div>
                <div class="stars">
                    ${starsHtml}
                </div>
                <p class="review-text">${text}</p>
            `;
            
            // Add to reviews list
            const reviewsList = document.getElementById('reviewsList');
            reviewsList.insertBefore(newReview, reviewsList.firstChild);
            
            // Reset form
            this.reset();
            
            // Show success message
            alert('Votre avis a été publié avec succès !');
        });
    </script>
